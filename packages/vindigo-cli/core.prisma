model Session {
    id        String   @id
    sid       String   @unique
    data      String
    expiresAt DateTime

    @@map(name: "sessions")
}

model User {
    id         Int             @id @default(autoincrement())
    username   String
    email      String
    password   String
    avatar     String?
    bio        String?
    name       String
    role       String
    language   String
    website    String?
    createdAt  DateTime
    lastSeenAt DateTime
    isEnabled  Boolean
    isVerified Boolean
    verifyCode String?
    projects   ProjectMember[]
    teams      TeamMember[]
    created    Project[]
    tasks      TaskMember[]
    watching   TaskWatcher[]

    @@map(name: "users")
}

model Project {
    id              Int             @id @default(autoincrement())
    name            String
    readme          String?
    readmeHtml      String?
    accentColor     String
    description     String?
    coverImage      String?
    backgroundImage String?
    isVisible       Boolean
    isClosed        Boolean
    isPublic        Boolean
    createdAt       DateTime
    lastModifiedAt  DateTime
    creatorId       Int
    creator         User            @relation(fields: [creatorId], references: [id])
    members         ProjectMember[]
    teams           ProjectTeam[]
    labels          Label[]

    @@map("projects")
}

model ProjectMember {
    id          Int     @id @default(autoincrement())
    memberId    Int
    projectId   Int
    accessLevel String
    project     Project @relation(fields: [projectId], references: [id])
    member      User    @relation(fields: [memberId], references: [id])

    @@map(name: "project_members")
}

model ProjectTeam {
    id          Int     @id @default(autoincrement())
    teamId      Int
    projectId   Int
    accessLevel String
    project     Project @relation(fields: [projectId], references: [id])
    team        Team    @relation(fields: [teamId], references: [id])

    @@map(name: "project_teams")
}

model Label {
    id          Int         @id @default(autoincrement())
    color       String
    title       String
    orderNumber Int
    projectId   Int
    project     Project     @relation(fields: [projectId], references: [id])
    tasks       TaskLabel[]

    @@map("labels")
}

model Task {
    id             Int           @id @default(autoincrement())
    parentId       Int?
    createdAt      DateTime
    lastModifiedAt DateTime
    summary        String
    description    String?
    isArchived     Boolean
    startTime      DateTime?
    endTime        DateTime?
    parent         Task?         @relation("parent", fields: [parentId], references: [id])
    children       Task[]        @relation("parent")
    members        TaskMember[]
    watchers       TaskWatcher[]
    labels         TaskLabel[]

    @@map(name: "tasks")
}

model TaskMember {
    id       Int      @id @default(autoincrement())
    memberId Int
    taskId   Int
    joinedAt DateTime
    member   User     @relation(fields: [memberId], references: [id])
    task     Task     @relation(fields: [taskId], references: [id])

    @@map("task_members")
}

model TaskWatcher {
    id       Int  @id @default(autoincrement())
    memberId Int
    taskId   Int
    member   User @relation(fields: [memberId], references: [id])
    task     Task @relation(fields: [taskId], references: [id])

    @@map("task_watchers")
}

model TaskLabel {
    id      Int   @id @default(autoincrement())
    taskId  Int
    labelId Int
    task    Task  @relation(fields: [taskId], references: [id])
    label   Label @relation(fields: [labelId], references: [id])

    @@map("task_labels")
}

model TeamMember {
    id       Int  @id @default(autoincrement())
    memberId Int
    teamId   Int
    member   User @relation(fields: [memberId], references: [id])
    team     Team @relation(fields: [teamId], references: [id])

    @@map(name: "team_members")
}

model Team {
    id          Int           @id @default(autoincrement())
    name        String
    description String?
    logoImage   String?
    createdAt   DateTime
    creatorId   Int
    projects    ProjectTeam[]
    members     TeamMember[]

    @@map(name: "teams")
}
